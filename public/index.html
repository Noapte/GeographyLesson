<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
</head>
<body>
<canvas id="myCanvas" style=" margin:20px" width="400" height="400"></canvas>
<p id="canText" type="text"></p>

    var countries = [];
    $(document).ready(function () {
        $.ajax({
            url: "countries.txt",
            dataType: "text",
            success: function (data) {
                countries = data.split('\r\n');
                $("#canText").text(data);
                countries.forEach(function (data) {
                    var canvas = document.createElement("canvas");

                    var context = canvas.getContext("2d");
                    var img = new Image();
                    img.src = data + '.png';
                    canvas.height = img.height;
                    canvas.width = img.width;
                    img.onload = function () {
                        context.drawImage(img, 0, 0, img.width, img.height);
                        context.fill();
                        context.stroke();
                    }
                    images.push({img: getImage(data), context: canvas.getContext("2d")});
                });
            }
        });
    });
    function getImage(name) {
        var img = new Image();
        img.src = 'http://localhost:4567/' + name + '.png';
        return img;
    }
    var images = [];
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext("2d");
    var img = new Image();
    img.src = 'http://localhost:4567/map_origin.png';
    canvas.height = img.height;
    canvas.width = img.width;
    var canvasMouseX;
    var canvasMouseY;
    var width = 400;
    var height = 400;
    //img.onload = function () {
    context.drawImage(img, 0, 0, img.width, img.height);
    context.fill();
    context.stroke();
    //   }
    var onClick = true;
    $('#myCanvas').mousemove(function (event) {
        canvasMouseX = event.clientX - (canvas.offsetLeft - window.pageXOffset);
        canvasMouseY = event.clientY - (canvas.offsetTop - window.pageYOffset);
        if (onClick) {
            var onMouse = images.filter(function (data) {
                return data.context.getImageData(canvasMouseX, canvasMouseY, 1, 1).data[3] !== 0;
            });
            if (onMouse[0] !== undefined) {
                context.drawImage(img, 0, 0, img.width, img.height);
                context.drawImage(onMouse[0].img, 0, 0, onMouse[0].img.width, onMouse[0].img.height);
            } else {
                context.drawImage(img, 0, 0, img.width, img.height);
            }
        }
    });
    $('#myCanvas').mousedown(function (event) {
        onClick = !onClick;
    });
</script>
</body>
</html>