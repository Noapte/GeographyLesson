<head>
    <title>lekcja Ukraina</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-type" content="text/html; charset=ISO-8859-2"/>
    <link rel="stylesheet" href="lib/bootstrap-3.2.0/dist/css/bootstrap.min.css">
    <script src="lib/jquery-1.11.2/jquery.min.js"></script>
    <script src="lib/bootstrap-3.2.0/dist/js/bootstrap.min.js"></script>
</head>
<button id="slides" onclick="slides()" type="submit" class="btn btn-primary">powrót do lekcji</button>
<canvas id="myCanvas" style="margin:20px; display:inline-block" width="400" height="400"></canvas>
<div style="display:inline-block; position: absolute; top:0">
    <br>
    <button id="general" onclick="general()" type="button" class="btn btn-primary">ogólne informacje
    </button>
    <br>
    <br>
    <div id="listOfPlaces" class="list-group">
        <a href="#" class="list-group-item list-group-item-success active">Znajdz punkty</a>
    </div>
    <button id="tests" type="button" class="btn btn-primary disabled" data-toggle="tooltip" data-placement="top"
            title="Musisz znaleźć wszystkie punkty, aby przejść do testu">przejdź do testu
    </button>
</div>
<div id="myModalGeneral" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Ukraina</h4>
            </div>
            <div class="modal-body">
                <div style="display:inline-block; margin-right:20px">
                    <p>flaga</p>
                    <img id="flag" height="200" width="300">
                </div>

                <div style="display:inline-block">
                    <p>herb</p>
                    <img id="arms" height="200" width="200">
                </div>
                <br>
                <br>

                <p id="infoGeneral">info</p>
                <br>
                <b>informacje</b>
                <br>
                <br>
                <table class="table">
                    <tbody id="tableInfo">
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>
<div id="myModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 id="countryId" class="modal-title">Information about city</h4>
            </div>
            <div class="modal-body">
                <p id="info">info</p>
                <br>
                <br>

                <div style="display:inline-block; margin-right:20px"><img id="img1" height="200" width="200">

                    <p id="desc1"></p></div>

                <div style="display:inline-block"><img id="img2"  height="200" width="200">

                    <p id="desc2"></p></div>

            </div>
        </div>
    </div>
</div>
<script>
    var places = [];
    var images = [];
    var counter = 0;
    var canvasMouseX;
    var canvasMouseY;
    var onMouse;
    function slides() {
        window.location.href = "http://localhost:4567/slides.html?id=2";
    }
    $(document).ready(function () {

        $.ajax({
            url: "lessons/ukraina/places.txt",
            dataType: "text",
            success: function (data) {
                var dataCountries = data.split('\r\n');
                dataCountries.forEach(function (data) {
                    places.push(data);
                    $("#listOfPlaces").append('<a id=' + data + ' onclick=drawCountry(this.id) href="#" class="list-group-item">' + data + '</a>');
                    var canvas = document.createElement("canvas");
                    var context = canvas.getContext("2d");
                    var img = new Image();
                    img.src = "lessons/ukraina/" + data + '.png';
                    canvas.height = img.height;
                    canvas.width = img.width;
                    context.drawImage(img, 0, 0, img.width, img.height);
                    context.fill();
                    context.stroke();
                    images.push({
                        img: getImage(data),
                        context: canvas.getContext("2d"),
                        name: data,
                        info: "",
                        desc1: "",
                        desc2: ""

                    });

                });

            }
        });

        $.ajax({
            url: "lessons/ukraina/info.txt",
            dataType: "text",
            success: function (data) {
                var info = data.split('\r\n');
                for (var i = 0; i < images.length; i++) {
                    images[i].info = info[i];
                }
            }
        });

        $.ajax({
            url: "lessons/ukraina/desc.txt",
            dataType: "text",
            success: function (data) {
                var description = data.split('\r\n');
                for (var i = 0; i < images.length; i++) {
                    var split = description[i].split(';');
                    images[i].desc1 = split[0];
                    images[i].desc2 = split[1];
                }
            }
        });

        $.ajax({
            url: "lessons/ukraina/general/info.txt",
            dataType: "text",
            success: function (data) {
                $("#infoGeneral").text(data);
                $("#flag").attr('src', 'http://localhost:4567/lessons/ukraina/general/flag.png');
                $("#arms").attr('src', 'http://localhost:4567/lessons/ukraina/general/arms.png');
            }
        });

        $.ajax({
            url: "lessons/ukraina/general/table.txt",
            dataType: "text",
            success: function (data) {
                var info = data.split('\r\n');
                for (var i = 0; i < info.length; i++) {
                    var split = info[i].split('-');
                    $("#tableInfo").append('<tr><td>' + split[0] + '</td><td>' + split[1] + '</td></tr>');
                }
            }
        });
    });
    function getImage(name) {
        var img = new Image();
        img.src = 'http://localhost:4567/lessons/ukraina/' + name + '.png';
        return img;
    }
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext("2d");
    var img = new Image();
    img.src = 'http://localhost:4567/lessons/ukraina/ukraina-slides.png';
    canvas.height = img.height;
    canvas.width = img.width;
    context.drawImage(img, 0, 0, img.width, img.height);
    context.fill();
    context.stroke();


    $('#myCanvas').mousemove(function (event) {
        canvasMouseX = event.clientX - (canvas.offsetLeft - window.pageXOffset);
        canvasMouseY = event.clientY - (canvas.offsetTop - window.pageYOffset);

        onMouse = images.filter(function (data) {
            return data.context.getImageData(canvasMouseX, canvasMouseY, 1, 1).data[3] !== 0;
        });

    });
    $('#myCanvas').mousedown(function (event) {
        if (onMouse[0].name !== undefined) {
            if (++counter === places.length) {
                $("#tests").removeClass().addClass("btn btn-primary");
            }
            $("#myModal").modal('show');
            $("#countryId").text(onMouse[0].name);
            $("#info").text(onMouse[0].info);
            $("#img1").attr('src', 'http://localhost:4567/lessons/ukraina/' + onMouse[0].name + '/1.jpg');
            $("#desc1").text(onMouse[0].desc1);
            $("#img2").attr('src', 'http://localhost:4567/lessons/ukraina/' + onMouse[0].name + '/2.jpg');
            $("#desc2").text(onMouse[0].desc2);
            $("#" + onMouse[0].name).removeClass().addClass("list-group-item list-group-item-success");
        }
    });

    function general() {
        $("#myModalGeneral").modal('show');
    }

</script>